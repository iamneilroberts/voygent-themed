# Data Model: Feature 011 Status Report

**Feature**: 012-peek-at-specs
**Date**: 2025-10-07
**Purpose**: Define data structures for Feature 011 implementation status report

## Overview

This document defines the data model for the Feature 011 status review report. The report is generated by analyzing the codebase and provides a comprehensive view of implementation progress, gaps, and next steps.

## Core Entities

### StatusReport

**Purpose**: Root object containing complete Feature 011 implementation status

**Attributes**:
- `feature_id` (string, required): Feature identifier, e.g., "011-transform-voygent-to"
- `feature_name` (string, required): Human-readable feature name
- `total_requirements` (integer, required): Total number of functional requirements (18 for Feature 011)
- `requirements_status` (RequirementStatus[], required): Status of each functional requirement
- `admin_interface` (AdminInterfaceStatus, required): Admin UI capability assessment
- `dashboard` (DashboardStatus, required): Dashboard capability assessment
- `migrations` (MigrationStatus, required): Database migration status
- `gaps` (Gap[], required): Identified implementation gaps
- `next_steps` (Task[], required): Prioritized task list for completion
- `generated_at` (ISO 8601 timestamp, required): When report was generated

**Relationships**:
- Contains 18 RequirementStatus objects (one per FR-001 through FR-018)
- Contains 1 AdminInterfaceStatus object
- Contains 1 DashboardStatus object
- Contains 1 MigrationStatus object
- Contains 0-N Gap objects (gaps found during analysis)
- Contains 0-N Task objects (next steps to complete feature)

**Validation Rules**:
- `total_requirements` must equal length of `requirements_status` array
- `feature_id` must match pattern "NNN-kebab-case-name"
- `generated_at` must be valid ISO 8601 timestamp

---

### RequirementStatus

**Purpose**: Tracks implementation status of a single functional requirement from Feature 011

**Attributes**:
- `id` (string, required): Requirement identifier, e.g., "FR-001"
- `title` (string, required): Short requirement title
- `status` (enum, required): One of:
  - `"complete"`: Requirement fully implemented and verified
  - `"in_progress"`: Requirement partially implemented
  - `"not_started"`: Requirement not yet begun
- `evidence` (string[], optional): File paths or code references proving completion
  - Only populated when status = "complete"
  - Examples: ["public/admin.html:45-67", "functions/api/lib/trip-templates.ts:89"]
- `blockers` (string[], optional): Obstacles preventing completion
  - Only populated when status = "in_progress" or "not_started"
  - Examples: ["Missing Amadeus API credentials", "Depends on migration 020 being applied"]

**Relationships**:
- Belongs to StatusReport
- May reference Gap objects (via requirement_id)
- May reference Task objects (tasks that implement this requirement)

**Validation Rules**:
- `id` must match pattern "FR-\\d{3}"
- `evidence` array must be empty when status ≠ "complete"
- `blockers` array should be empty when status = "complete"

**State Transitions**:
```
not_started → in_progress → complete
     ↓             ↓
   (blocked)   (blocked)
```

---

### AdminInterfaceStatus

**Purpose**: Assesses capabilities of the admin interface at /admin

**Attributes**:
- `url` (string, required): Admin interface path, e.g., "/admin"
- `accessible` (boolean, required): Whether admin.html file exists and loads
- `features` (FeatureCheck[], required): List of capability checks
- `missing_capabilities` (string[], required): Capabilities required but not present

**Relationships**:
- Belongs to StatusReport
- Contains N FeatureCheck objects

**Validation Rules**:
- If `accessible` = false, `features` array may be empty
- `missing_capabilities` should list only capabilities required by Feature 011 FR-002, FR-004

---

### DashboardStatus

**Purpose**: Assesses capabilities of the admin dashboard at /admin-dashboard

**Attributes**:
- `url` (string, required): Dashboard path, e.g., "/admin-dashboard"
- `accessible` (boolean, required): Whether admin-dashboard.html file exists and loads
- `features` (FeatureCheck[], required): List of capability checks
- `missing_capabilities` (string[], required): Capabilities required but not present

**Relationships**:
- Belongs to StatusReport
- Contains N FeatureCheck objects

**Validation Rules**:
- If `accessible` = false, `features` array may be empty
- `missing_capabilities` should list only capabilities required by Feature 011 FR-006

---

### FeatureCheck

**Purpose**: Represents a single capability check for admin interface or dashboard

**Attributes**:
- `capability` (string, required): What was checked, e.g., "Template CRUD operations"
- `present` (boolean, required): Whether capability is implemented
- `notes` (string, optional): Additional context, e.g., "Edit form missing workflow_prompt field"

**Relationships**:
- Belongs to AdminInterfaceStatus or DashboardStatus

**Validation Rules**:
- `capability` must be non-empty string
- `notes` should explain why `present` = false if applicable

---

### MigrationStatus

**Purpose**: Tracks database migration files required for Feature 011

**Attributes**:
- `required` (Migration[], required): Migrations needed for Feature 011
- `applied` (Migration[], required): Migrations already applied to database
- `pending` (Migration[], required): Migrations created but not yet applied

**Relationships**:
- Belongs to StatusReport
- Contains 2 required Migration objects for Feature 011:
  1. 020_extend_trip_templates.sql
  2. 021_create_handoff_documents.sql

**Validation Rules**:
- `required` array must contain exactly 2 migrations for Feature 011
- A migration can appear in only one of: `applied`, `pending`, or neither (missing)

**Derived Fields** (calculated):
- `missing`: Migrations in `required` but not in `applied` or `pending`
- `completion_rate`: (length of `applied`) / (length of `required`)

---

### Migration

**Purpose**: Represents a single database migration file

**Attributes**:
- `filename` (string, required): Migration file name, e.g., "020_extend_trip_templates.sql"
- `purpose` (string, required): What this migration does
- `status` (enum, required): One of:
  - `"applied"`: Migration has been run on database
  - `"pending"`: Migration file exists but not yet applied
  - `"missing"`: Migration file doesn't exist yet

**Relationships**:
- Belongs to MigrationStatus

**Validation Rules**:
- `filename` must match pattern "\\d{3}_[a-z_]+\\.sql"
- `status` must be one of three allowed values

---

### Gap

**Purpose**: Represents an identified implementation gap blocking Feature 011 completion

**Attributes**:
- `requirement_id` (string, required): Which FR this gap relates to, e.g., "FR-007"
- `description` (string, required): What's missing, e.g., "Amadeus Flight API integration not implemented"
- `severity` (enum, required): One of:
  - `"blocking"`: Prevents Feature 011 from functioning
  - `"important"`: Feature works but missing key capability
  - `"nice_to_have"`: Enhancement, not critical path
- `estimated_effort` (enum, required): One of:
  - `"small"`: < 2 hours
  - `"medium"`: 2-8 hours
  - `"large"`: > 8 hours

**Relationships**:
- Belongs to StatusReport
- References RequirementStatus via `requirement_id`
- May spawn Task objects to close the gap

**Validation Rules**:
- `requirement_id` must match a valid FR-XXX from Feature 011
- `description` must be actionable (describe what to implement, not just problem)

**Priority Calculation**:
```javascript
const severityWeight = { blocking: 10, important: 7, nice_to_have: 4 };
const effortCost = { small: 1, medium: 3, large: 5 };
const priority = severityWeight[severity] - effortCost[estimated_effort];
```

---

### Task

**Purpose**: Represents an actionable next step to complete Feature 011

**Attributes**:
- `id` (integer, required): Unique task number, 1-based sequential
- `description` (string, required): What to do, e.g., "Create migration 020_extend_trip_templates.sql"
- `dependencies` (integer[], optional): IDs of tasks that must complete first
- `estimated_effort` (enum, required): One of "small", "medium", "large"
- `priority` (integer, required): 1-10, where 10 = highest priority

**Relationships**:
- Belongs to StatusReport
- May reference Gap objects (task addresses a gap)
- May reference other Task objects via `dependencies`

**Validation Rules**:
- `id` must be unique within StatusReport
- `dependencies` must reference valid task IDs within same report
- `dependencies` must not create cycles (no circular dependencies)
- `priority` must be 1-10 inclusive

**Ordering Rules**:
- Tasks are ordered by priority (descending)
- Tasks with dependencies must appear after their dependencies
- Tasks with no dependencies can be executed in parallel

---

## Example Data

### Complete StatusReport Example (Abbreviated)

```json
{
  "feature_id": "011-transform-voygent-to",
  "feature_name": "Transform Voygent to Prompt-Driven Template System",
  "total_requirements": 18,
  "requirements_status": [
    {
      "id": "FR-001",
      "title": "Production Deployment Verification",
      "status": "complete",
      "evidence": [
        "wrangler.toml:production_branch:main",
        "Cloudflare Pages deployment logs confirm main branch deployed"
      ],
      "blockers": []
    },
    {
      "id": "FR-004",
      "title": "Template Schema Extensions",
      "status": "not_started",
      "evidence": [],
      "blockers": [
        "Migration 020_extend_trip_templates.sql not created yet"
      ]
    }
  ],
  "admin_interface": {
    "url": "/admin",
    "accessible": true,
    "features": [
      {
        "capability": "Template list view",
        "present": true,
        "notes": "Templates displayed in table format"
      },
      {
        "capability": "Template edit form with all FR-004 fields",
        "present": false,
        "notes": "Missing workflow_prompt, progress_messages, and luxury_levels fields"
      }
    ],
    "missing_capabilities": [
      "workflow_prompt field in edit form",
      "progress_messages JSON editor",
      "luxury_levels array editor"
    ]
  },
  "dashboard": {
    "url": "/admin-dashboard",
    "accessible": true,
    "features": [
      {
        "capability": "Log viewing",
        "present": true
      },
      {
        "capability": "Correlation ID filter",
        "present": false,
        "notes": "Dashboard shows all logs, no filtering by correlation_id"
      }
    ],
    "missing_capabilities": [
      "Correlation ID filter",
      "Real-time log updates"
    ]
  },
  "migrations": {
    "required": [
      {
        "filename": "020_extend_trip_templates.sql",
        "purpose": "Add FR-004 columns to trip_templates table",
        "status": "pending"
      },
      {
        "filename": "021_create_handoff_documents.sql",
        "purpose": "Create handoff_documents table for FR-016",
        "status": "missing"
      }
    ],
    "applied": [],
    "pending": [
      {
        "filename": "020_extend_trip_templates.sql",
        "purpose": "Add FR-004 columns to trip_templates table",
        "status": "pending"
      }
    ]
  },
  "gaps": [
    {
      "requirement_id": "FR-004",
      "description": "Migration 020_extend_trip_templates.sql not applied to database",
      "severity": "blocking",
      "estimated_effort": "small"
    },
    {
      "requirement_id": "FR-007",
      "description": "Amadeus Flight API integration not implemented",
      "severity": "blocking",
      "estimated_effort": "large"
    }
  ],
  "next_steps": [
    {
      "id": 1,
      "description": "Apply migration 020_extend_trip_templates.sql to database",
      "dependencies": [],
      "estimated_effort": "small",
      "priority": 9
    },
    {
      "id": 2,
      "description": "Add workflow_prompt, progress_messages fields to admin template editor",
      "dependencies": [1],
      "estimated_effort": "medium",
      "priority": 6
    },
    {
      "id": 3,
      "description": "Implement Amadeus Flight API integration",
      "dependencies": [1],
      "estimated_effort": "large",
      "priority": 5
    }
  ],
  "generated_at": "2025-10-07T19:30:00Z"
}
```

## State Diagrams

### RequirementStatus Lifecycle

```
┌─────────────┐
│ not_started │
└──────┬──────┘
       │ Work begins
       ▼
┌─────────────┐
│ in_progress │◄───┐ Blocker found
└──────┬──────┘    │
       │ Completed │
       ▼           │
┌─────────────┐   │
│  complete   │   │
└─────────────┘   │
                  │
       Blocker removed
```

### Migration Lifecycle

```
┌─────────┐
│ missing │ (file doesn't exist)
└────┬────┘
     │ File created
     ▼
┌─────────┐
│ pending │ (file exists, not applied)
└────┬────┘
     │ Applied to database
     ▼
┌─────────┐
│ applied │ (schema updated)
└─────────┘
```

## Cardinality

```
StatusReport
├── requirements_status [18]         # Exactly 18 for Feature 011
├── admin_interface [1]              # Exactly 1
│   └── features [0..N]
├── dashboard [1]                    # Exactly 1
│   └── features [0..N]
├── migrations [1]                   # Exactly 1
│   ├── required [2]                 # Exactly 2 for Feature 011
│   ├── applied [0..2]
│   └── pending [0..2]
├── gaps [0..N]                      # 0 when feature complete
└── next_steps [0..N]                # 0 when feature complete
```

## Indexes and Lookups

For efficient report generation and querying:

1. **Requirements by Status**: Group requirements_status by `status` field
   - Enables quick "X complete, Y in-progress, Z not-started" summary
2. **Gaps by Severity**: Group gaps by `severity` field
   - Enables filtering to "show me blocking gaps only"
3. **Tasks by Dependencies**: Index tasks by `dependencies` array
   - Enables dependency graph visualization and parallel task identification
4. **Tasks by Priority**: Sort tasks by `priority` (descending)
   - Enables "what should I work on next?" answer

## Report Generation Sequence

```
1. Load Feature 011 spec
   └─> Extract 18 functional requirements

2. For each requirement (FR-001 through FR-018):
   ├─> Check for implementation evidence in codebase
   ├─> Determine status (complete/in-progress/not-started)
   ├─> List evidence if complete
   └─> List blockers if incomplete

3. Check admin interface:
   ├─> Parse public/admin.html
   ├─> Check for each FR-002/FR-004 capability
   └─> List missing capabilities

4. Check dashboard:
   ├─> Parse public/admin-dashboard.html
   ├─> Check for each FR-006 capability
   └─> List missing capabilities

5. Check migrations:
   ├─> List files in migrations/ directory
   ├─> Compare against required [020, 021]
   └─> Determine status (applied/pending/missing)

6. Identify gaps:
   ├─> For each incomplete requirement
   ├─> Classify severity (blocking/important/nice-to-have)
   └─> Estimate effort (small/medium/large)

7. Generate next steps:
   ├─> Convert gaps into actionable tasks
   ├─> Calculate priorities
   ├─> Order by dependencies and priority
   └─> Assign sequential task IDs

8. Assemble final StatusReport:
   └─> Validate against JSON schema
```

## Validation

The generated status report must validate against the JSON schema defined in `contracts/status-report.json`. Key validation rules:

1. All required fields present
2. Enums match allowed values ("complete"/"in-progress"/"not_started", etc.)
3. Arrays contain objects with correct structure
4. `total_requirements` = length of `requirements_status`
5. `requirement_id` references in Gap objects match actual requirement IDs
6. Task dependencies reference valid task IDs
7. No circular dependencies in tasks
8. `generated_at` is valid ISO 8601 timestamp

---

**Next**: See `contracts/status-report.json` for machine-readable JSON schema.
